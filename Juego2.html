<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Juego de la Gran Colombia</title>
    <!-- Tailwind CSS CDN para un diseño moderno y responsivo -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Estilos personalizados para el juego */
        body {
            font-family: 'Inter', sans-serif;
        }
        .grid-container {
            display: grid;
            grid-template-columns: repeat(12, minmax(0, 1fr));
            width: 100%;
            aspect-ratio: 1 / 1;
        }
        .grid-cell {
            border: 1px solid #d1d5db; /* gray-300 */
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .grid-cell input {
            text-align: center;
            font-weight: bold;
            text-transform: uppercase;
            border: none;
            outline: none;
            width: 100%;
            height: 100%;
            background-color: transparent;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen p-8 flex items-center justify-center">

    <!-- Contenedor principal de la aplicación -->
    <div id="game-app" class="w-full max-w-5xl">

        <!-- Pantalla del Menú Principal -->
        <div id="menu-screen" class="w-full max-w-2xl text-center">
            <h1 class="text-5xl md:text-6xl font-extrabold text-blue-900 mb-6 drop-shadow-md">
                Juego de la Gran Colombia
            </h1>
            <p class="text-lg md:text-xl text-gray-700 mb-12">
                Selecciona un modo de juego para empezar la aventura histórica.
            </p>
            <div class="flex flex-col md:flex-row gap-6">
                <div class="flex-1 bg-white rounded-xl shadow-xl hover:shadow-2xl transition-shadow duration-300 transform hover:scale-105 p-6">
                    <h2 class="text-2xl font-bold text-indigo-700 mb-2">Crucigrama</h2>
                    <p class="text-gray-600 mb-4">
                        Completa el crucigrama con palabras clave de la historia de la Gran Colombia.
                    </p>
                    <button id="play-crossword-btn" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 text-lg rounded-md">
                        Jugar Crucigrama
                    </button>
                </div>
                <div class="flex-1 bg-white rounded-xl shadow-xl hover:shadow-2xl transition-shadow duration-300 transform hover:scale-105 p-6">
                    <h2 class="text-2xl font-bold text-indigo-700 mb-2">Sopa de Letras</h2>
                    <p class="text-gray-600 mb-4">
                        Encuentra las palabras escondidas en la cuadrícula y demuestra tu conocimiento.
                    </p>
                    <button id="play-wordsearch-btn" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 text-lg rounded-md">
                        Jugar Sopa de Letras
                    </button>
                </div>
            </div>
        </div>

        <!-- Pantalla del Crucigrama (oculto por defecto) -->
        <div id="crossword-screen" class="w-full bg-white rounded-xl shadow-2xl p-6 hidden">
            <h2 class="text-3xl font-bold text-indigo-700 text-center mb-6">Crucigrama Histórico</h2>
            <div class="flex flex-col lg:flex-row gap-8">
                <!-- Cuadrícula del crucigrama -->
                <div id="crossword-grid-container" class="flex-1 min-w-0">
                    <!-- El grid se renderizará aquí con JavaScript -->
                </div>
                <!-- Panel de pistas y controles -->
                <div class="flex-1 flex flex-col justify-between">
                    <div>
                        <h3 class="text-2xl font-bold mb-4 text-indigo-800">Claves:</h3>
                        <div id="clues-list" class="space-y-2 overflow-y-auto max-h-60">
                            <!-- Las pistas se renderizarán aquí con JavaScript -->
                        </div>
                    </div>
                    <div class="flex flex-col md:flex-row gap-4 mt-6">
                        <button id="check-crossword-btn" class="flex-1 bg-green-600 hover:bg-green-700 text-white font-bold py-3 text-lg rounded-md">
                            Comprobar
                        </button>
                        <button id="crossword-back-btn" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 text-lg rounded-md">
                            Volver al Menú
                        </button>
                    </div>
                    <div class="mt-4">
                        <p class="text-sm text-gray-600 mb-2">Comandos: `!pista [número]`</p>
                        <div class="flex gap-2">
                            <input id="crossword-command-input" type="text" class="flex-1 p-2 border rounded-md focus:outline-none focus:border-indigo-500" placeholder="Escribe un comando...">
                            <button id="crossword-command-btn" class="bg-indigo-500 text-white px-4 rounded-md">Enviar</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pantalla de la Sopa de Letras (oculto por defecto) -->
        <div id="wordsearch-screen" class="w-full bg-white rounded-xl shadow-2xl p-6 hidden">
            <h2 class="text-3xl font-bold text-indigo-700 text-center mb-6">Sopa de Letras Histórica</h2>
            <div class="flex flex-col lg:flex-row gap-8">
                <!-- Cuadrícula de la sopa de letras -->
                <div id="wordsearch-grid-container" class="flex-1">
                    <!-- El grid se renderizará aquí con JavaScript -->
                </div>
                <!-- Panel de palabras y controles -->
                <div class="flex-1 flex flex-col justify-between">
                    <div>
                        <h3 class="text-2xl font-bold mb-4 text-indigo-800">Palabras a encontrar:</h3>
                        <ul id="words-to-find-list" class="space-y-2 overflow-y-auto max-h-60">
                            <!-- La lista de palabras se renderizará aquí con JavaScript -->
                        </ul>
                    </div>
                    <div class="flex flex-col md:flex-row gap-4 mt-6">
                        <button id="wordsearch-back-btn" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 text-lg rounded-md">
                            Volver al Menú
                        </button>
                    </div>
                    <div class="mt-4">
                        <p class="text-sm text-gray-600 mb-2">Comandos: `!resolver`</p>
                        <div class="flex gap-2">
                            <input id="wordsearch-command-input" type="text" class="flex-1 p-2 border rounded-md focus:outline-none focus:border-indigo-500" placeholder="Escribe un comando...">
                            <button id="wordsearch-command-btn" class="bg-indigo-500 text-white px-4 rounded-md">Enviar</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal de alerta (oculto por defecto) -->
        <div id="custom-alert-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="bg-white rounded-lg p-6 max-w-sm w-full text-center shadow-lg">
                <h2 id="modal-title" class="text-2xl font-bold mb-2"></h2>
                <p id="modal-description" class="text-gray-700 mb-4"></p>
                <button id="modal-close-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-md">Aceptar</button>
            </div>
        </div>

    </div>

    <script>
        // Game data and state management
        const gameData = {
            crossword: {
                words: [
                    { word: 'BOLIVAR', clue: 'Líder principal de la Gran Colombia y "el Libertador".', start: { row: 0, col: 4 }, direction: 'down' },
                    { word: 'CUCUTA', clue: 'Ciudad sede del congreso de 1821 donde se estableció la constitución.', start: { row: 3, col: 0 }, direction: 'down' },
                    { word: 'SANTANDER', clue: 'Vicepresidente de la Gran Colombia, defensor del civilismo.', start: { row: 1, col: 6 }, direction: 'down' },
                    { word: 'VENEZUELA', clue: 'País que se separó de la Gran Colombia en 1830 bajo el liderazgo de Páez.', start: { row: 3, col: 0 }, direction: 'right' },
                    { word: 'CARABOBO', clue: 'Batalla que aseguró la independencia de Venezuela en 1821.', start: { row: 6, col: 2 }, direction: 'down' },
                    { word: 'BOGOTA', clue: 'Capital de la Gran Colombia.', start: { row: 6, col: 5 }, direction: 'right' },
                    { word: 'PAEZ', clue: 'General venezolano que lideró la separación de la Gran Colombia.', start: { row: 2, col: 9 }, direction: 'down' },
                    { word: 'ANGUSTURA', clue: 'Lugar del primer congreso donde se decidió crear la República de Colombia.', start: { row: 1, col: 4 }, direction: 'right' }
                ]
            },
            wordSearch: ['BOLIVAR', 'CUCUTA', 'SANTANDER', 'VENEZUELA', 'CARABOBO', 'BOGOTA', 'AYACUCHO', 'PAEZ', 'ANGUSTURA', 'COLOMBIA', 'ECUADOR', 'PANAMA', 'GUERRA', 'LIBERTAD', 'MARQUEZ', 'PASTO'],
        };
        
        let gameState = 'menu';
        const gridSize = 12;
        let crosswordGridState = [];
        let wordSearchGridState = [];
        let foundWords = new Set();
        let selectedCells = [];
        let foundCellsCoords = [];

        // Referencias a los elementos del DOM
        const menuScreen = document.getElementById('menu-screen');
        const crosswordScreen = document.getElementById('crossword-screen');
        const wordsearchScreen = document.getElementById('wordsearch-screen');
        const customAlertModal = document.getElementById('custom-alert-modal');
        const modalTitle = document.getElementById('modal-title');
        const modalDescription = document.getElementById('modal-description');
        const modalCloseBtn = document.getElementById('modal-close-btn');

        // Función para mostrar la modal
        function showAlert(title, description, isCorrect = true) {
            modalTitle.textContent = title;
            modalDescription.textContent = description;
            modalTitle.className = isCorrect ? 'text-2xl font-bold mb-2 text-green-600' : 'text-2xl font-bold mb-2 text-red-600';
            customAlertModal.classList.remove('hidden');
        }

        // Función para cambiar de pantalla
        function switchScreen(screenId) {
            menuScreen.classList.add('hidden');
            crosswordScreen.classList.add('hidden');
            wordsearchScreen.classList.add('hidden');
            document.getElementById(screenId).classList.remove('hidden');
            gameState = screenId.replace('-screen', '');
        }

        // --- Lógica del Crucigrama ---
        function renderCrosswordGrid() {
            const gridContainer = document.getElementById('crossword-grid-container');
            gridContainer.innerHTML = ''; // Limpiar la cuadrícula
            crosswordGridState = Array(gridSize).fill(null).map(() => Array(gridSize).fill(''));
            const words = gameData.crossword.words;

            const gridDiv = document.createElement('div');
            gridDiv.className = 'grid-container w-full max-w-full border border-gray-400';

            for (let r = 0; r < gridSize; r++) {
                for (let c = 0; c < gridSize; c++) {
                    const cellDiv = document.createElement('div');
                    cellDiv.className = 'relative border border-gray-300 aspect-square';
                    cellDiv.dataset.row = r;
                    cellDiv.dataset.col = c;
                    
                    const isCellUsed = words.some(wordData => {
                        const { word, start, direction } = wordData;
                        if (direction === 'down') {
                            return c === start.col && r >= start.row && r < start.row + word.length;
                        } else { // 'right'
                            return r === start.row && c >= start.col && c < start.col + word.length;
                        }
                    });

                    if (isCellUsed) {
                        cellDiv.classList.add('bg-white');
                        const input = document.createElement('input');
                        input.type = 'text';
                        input.maxLength = 1;
                        input.className = 'w-full h-full text-center text-sm md:text-xl font-bold bg-white focus:outline-none';
                        input.addEventListener('input', (e) => {
                            crosswordGridState[r][c] = e.target.value.toUpperCase();
                        });
                        cellDiv.appendChild(input);

                        const isStartCell = words.find(wordData => wordData.start.row === r && wordData.start.col === c);
                        if (isStartCell) {
                            const startNumber = words.indexOf(isStartCell) + 1;
                            const numberSpan = document.createElement('span');
                            numberSpan.className = 'absolute -top-1 -left-1 text-xs text-gray-600 font-semibold p-1 bg-white rounded-full z-10';
                            numberSpan.textContent = startNumber;
                            cellDiv.appendChild(numberSpan);
                        }
                    } else {
                        cellDiv.classList.add('bg-gray-300');
                    }
                    gridDiv.appendChild(cellDiv);
                }
            }
            gridContainer.appendChild(gridDiv);
        }

        function renderCrosswordClues() {
            const cluesList = document.getElementById('clues-list');
            cluesList.innerHTML = '';
            gameData.crossword.words.forEach((wordData, index) => {
                const clueElement = document.createElement('p');
                clueElement.className = 'text-gray-700';
                const directionText = wordData.direction === 'down' ? 'Vertical' : 'Horizontal';
                clueElement.innerHTML = `<span class="font-bold text-indigo-600 mr-2">${index + 1}. (${directionText}):</span> ${wordData.clue}`;
                cluesList.appendChild(clueElement);
            });
        }

        function checkCrosswordSolution() {
            let incorrectWordsCount = 0;
            const words = gameData.crossword.words;

            words.forEach(wordData => {
                const { word, start, direction } = wordData;
                let userAnswer = '';
                const wordUpperCase = word.toUpperCase();

                if (direction === 'down') {
                    for (let i = 0; i < wordUpperCase.length; i++) {
                        userAnswer += crosswordGridState[start.row + i]?.[start.col] || '';
                    }
                } else { // 'right'
                    for (let i = 0; i < wordUpperCase.length; i++) {
                        userAnswer += crosswordGridState[start.row]?.[start.col + i] || '';
                    }
                }
                if (userAnswer !== wordUpperCase) {
                    incorrectWordsCount++;
                }
            });

            if (incorrectWordsCount === 0) {
                showAlert('¡Felicidades!', 'Has completado el crucigrama correctamente.');
            } else {
                showAlert('¡Aún no!', `Hay ${incorrectWordsCount} errores. ¡Sigue intentándolo!`, false);
            }
        }

        function handleCrosswordCommand() {
            const input = document.getElementById('crossword-command-input');
            const command = input.value.trim().toLowerCase();
            const words = gameData.crossword.words;

            if (command.startsWith('!pista')) {
                const parts = command.split(' ');
                if (parts.length === 2) {
                    const clueNumber = parseInt(parts[1], 10);
                    const wordData = words[clueNumber - 1];
                    if (wordData) {
                        const { word, start, direction } = wordData;
                        const wordUpperCase = word.toUpperCase();
                        let letterRevealed = false;
                        for (let i = 0; i < wordUpperCase.length; i++) {
                            const row = start.row + (direction === 'down' ? i : 0);
                            const col = start.col + (direction === 'right' ? i : 0);
                            if (crosswordGridState[row][col] === '') {
                                crosswordGridState[row][col] = wordUpperCase[i];
                                document.querySelector(`[data-row="${row}"][data-col="${col}"] input`).value = wordUpperCase[i];
                                letterRevealed = true;
                                break;
                            }
                        }
                        if (letterRevealed) {
                            showAlert('¡Pista!', `Se ha revelado una letra para la palabra ${clueNumber}.`);
                        } else {
                            showAlert('Palabra completa', `La palabra ${clueNumber} ya está completa.`, false);
                        }
                    } else {
                        showAlert('Error', 'Número de pista no válido.', false);
                    }
                } else {
                    showAlert('Error', 'Comando inválido. Usa: !pista [número]', false);
                }
            } else {
                showAlert('Error', 'Comando no reconocido. Usa: !pista [número]', false);
            }
            input.value = '';
        }
        
        // --- Lógica de la Sopa de Letras ---
        const flagColors = ['bg-yellow-300 text-yellow-900', 'bg-blue-300 text-blue-900', 'bg-red-300 text-red-900'];

        function renderWordSearchGrid() {
            const gridContainer = document.getElementById('wordsearch-grid-container');
            gridContainer.innerHTML = '';
            wordSearchGridState = Array(gridSize).fill(null).map(() => Array(gridSize).fill(''));
            foundWords = new Set();
            selectedCells = [];
            foundCellsCoords = [];

            const placedWords = [];
            const wordsToPlace = [...gameData.wordSearch].map(w => w.toUpperCase());
        
            const placeWord = (word) => {
                const directions = [{dr: 0, dc: 1}, {dr: 1, dc: 0}, {dr: 1, dc: 1}, {dr: 1, dc: -1}, {dr: 0, dc: -1}, {dr: -1, dc: 0}];
                const direction = directions[Math.floor(Math.random() * directions.length)];
                let placed = false;
                let attempts = 0;
        
                while (!placed && attempts < 100) {
                    const startRow = Math.floor(Math.random() * gridSize);
                    const startCol = Math.floor(Math.random() * gridSize);
                    let canPlace = true;
        
                    if (direction.dr * word.length + startRow >= gridSize || direction.dc * word.length + startCol >= gridSize ||
                        direction.dr * word.length + startRow < 0 || direction.dc * word.length + startCol < 0) {
                        attempts++;
                        continue;
                    }
        
                    for (let i = 0; i < word.length; i++) {
                        const row = startRow + i * direction.dr;
                        const col = startCol + i * direction.dc;
                        if (row >= gridSize || col >= gridSize || row < 0 || col < 0 || (wordSearchGridState[row][col] !== '' && wordSearchGridState[row][col] !== word[i])) {
                            canPlace = false;
                            break;
                        }
                    }
        
                    if (canPlace) {
                        for (let i = 0; i < word.length; i++) {
                            const row = startRow + i * direction.dr;
                            const col = startCol + i * direction.dc;
                            wordSearchGridState[row][col] = word[i];
                        }
                        placedWords.push(word);
                        placed = true;
                    }
                    attempts++;
                }
            };
        
            wordsToPlace.forEach(word => placeWord(word));
        
            const alphabet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
            for (let r = 0; r < gridSize; r++) {
                for (let c = 0; c < gridSize; c++) {
                    if (wordSearchGridState[r][c] === '') {
                        wordSearchGridState[r][c] = alphabet[Math.floor(Math.random() * alphabet.length)];
                    }
                }
            }

            const gridDiv = document.createElement('div');
            gridDiv.className = 'grid-container w-full aspect-square border border-gray-400';
            for (let r = 0; r < gridSize; r++) {
                for (let c = 0; c < gridSize; c++) {
                    const cellDiv = document.createElement('div');
                    cellDiv.className = 'grid-cell cursor-pointer hover:bg-gray-200 text-gray-700 font-bold text-base md:text-lg bg-gray-100';
                    cellDiv.dataset.row = r;
                    cellDiv.dataset.col = c;
                    cellDiv.textContent = wordSearchGridState[r][c];
                    cellDiv.addEventListener('click', () => handleWordSearchCellClick(r, c));
                    gridDiv.appendChild(cellDiv);
                }
            }
            gridContainer.appendChild(gridDiv);
            renderWordSearchWordsToFind();
        }

        function renderWordSearchWordsToFind() {
            const list = document.getElementById('words-to-find-list');
            list.innerHTML = '';
            gameData.wordSearch.forEach(word => {
                const li = document.createElement('li');
                li.className = `text-gray-700 text-lg`;
                li.textContent = word.toUpperCase();
                if (foundWords.has(word.toUpperCase())) {
                    li.classList.add('line-through', 'text-green-600');
                }
                list.appendChild(li);
            });
        }

        function handleWordSearchCellClick(row, col) {
            if (foundWords.size === gameData.wordSearch.length) return;

            const cell = { row, col };
            const isSelected = selectedCells.some(c => c.row === row && c.col === col);
            
            if (isSelected) {
                selectedCells = selectedCells.filter(c => !(c.row === row && c.col === col));
            } else {
                selectedCells.push(cell);
            }

            const cellElement = document.querySelector(`#wordsearch-grid-container .grid-cell[data-row="${row}"][data-col="${col}"]`);
            if (isSelected) {
                cellElement.classList.remove('bg-indigo-200', 'text-indigo-800');
                cellElement.classList.add('bg-gray-100', 'text-gray-700');
            } else {
                cellElement.classList.remove('bg-gray-100', 'text-gray-700');
                cellElement.classList.add('bg-indigo-200', 'text-indigo-800');
            }

            if (selectedCells.length > 1) {
                selectedCells.sort((a, b) => a.row === b.row ? a.col - b.col : a.row - b.row);
                const selectedWord = selectedCells.map(c => wordSearchGridState[c.row][c.col]).join('');
                const found = gameData.wordSearch.find(word => word.toUpperCase() === selectedWord || word.toUpperCase() === [...selectedWord].reverse().join(''));
                
                if (found && !foundWords.has(found.toUpperCase())) {
                    foundWords.add(found.toUpperCase());
                    const colorIndex = (foundWords.size - 1) % flagColors.length;
                    selectedCells.forEach(c => {
                        const cellElem = document.querySelector(`#wordsearch-grid-container .grid-cell[data-row="${c.row}"][data-col="${c.col}"]`);
                        cellElem.className = `grid-cell ${flagColors[colorIndex]}`;
                    });
                    
                    selectedCells = [];
                    renderWordSearchWordsToFind();
                    if (foundWords.size === gameData.wordSearch.length) {
                        showAlert('¡Felicidades!', 'Has encontrado todas las palabras. ¡Eres un experto en historia!');
                        document.querySelectorAll('#wordsearch-grid-container .grid-cell').forEach(cell => cell.classList.add('cursor-not-allowed'));
                    }
                }
            }
        }

        function handleWordSearchCommand() {
            const input = document.getElementById('wordsearch-command-input');
            const command = input.value.trim().toLowerCase();

            if (command === '!resolver') {
                foundWords = new Set(gameData.wordSearch.map(w => w.toUpperCase()));
                renderWordSearchWordsToFind();
                showAlert('¡Todas las palabras encontradas!', 'Has resuelto la sopa de letras.');

                document.querySelectorAll('#wordsearch-grid-container .grid-cell').forEach(cell => {
                    cell.classList.remove('cursor-pointer', 'hover:bg-gray-200');
                    cell.classList.add('cursor-not-allowed');
                });
            } else {
                showAlert('Error', 'Comando no reconocido. Usa: !resolver', false);
            }
            input.value = '';
        }

        // Event Listeners para la navegación y botones
        document.getElementById('play-crossword-btn').addEventListener('click', () => {
            switchScreen('crossword-screen');
            renderCrosswordGrid();
            renderCrosswordClues();
        });

        document.getElementById('play-wordsearch-btn').addEventListener('click', () => {
            switchScreen('wordsearch-screen');
            renderWordSearchGrid();
        });

        document.getElementById('crossword-back-btn').addEventListener('click', () => switchScreen('menu-screen'));
        document.getElementById('wordsearch-back-btn').addEventListener('click', () => switchScreen('menu-screen'));
        document.getElementById('modal-close-btn').addEventListener('click', () => customAlertModal.classList.add('hidden'));

        document.getElementById('check-crossword-btn').addEventListener('click', checkCrosswordSolution);
        document.getElementById('crossword-command-btn').addEventListener('click', handleCrosswordCommand);
        document.getElementById('crossword-command-input').addEventListener('keydown', (e) => {
            if (e.key === 'Enter') handleCrosswordCommand();
        });
        document.getElementById('wordsearch-command-btn').addEventListener('click', handleWordSearchCommand);
        document.getElementById('wordsearch-command-input').addEventListener('keydown', (e) => {
            if (e.key === 'Enter') handleWordSearchCommand();
        });

    </script>
</body>
</html>
